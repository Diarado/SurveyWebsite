<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Scoring Website</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="over"></div>

  <div id="top">
    <div id="displayInput"></div>
    <div id="tutorialDiv">
      <button id="tutorialButton"> read me before you start </button>
    </div>


    <div id="myModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <p>Here are your 6 steps instructions.</p>
        <p class="numbering">1</p>
        <p class="textinstruction"> Review the original visual element (left) and the drawing (right).
          The drawing was drawn based on the visual element on the left. Review the title of the drawing
          named by the creator below the two images. Scroll horizontally if the title is long.
        </p>
        <img class="imageinstruction" src="./instruction/instruction1.png" alt="instruction1">
        <hr>
        <p class="numbering">2</p>
        <p class="textinstruction"> Under drawings, there will be three criteria: 1.Vividness, 2.Originality, and
          3.Transformation.
          Each criterion has a slider on a scale of 0 to 2.
        </p>
        <img class="imageinstruction" src="./instruction/instruction2.png" alt="instruction2">
        <hr>

        <p class="numbering">3</p>
        <p class="textinstruction"> Start evaluating the 'Vividness' of the image.
          A evaluation guide pdf will appear on the right side if you click the 'Show Vividness criteria' button.
          Read the definition and examples drawings in the pdf then give a vividness score for the drawing (Forest
          goddess wathicng over ducks).
          Although the guide in the pdf categorized example drawings based on scores 0,1 and 2. You are allowed to
          give a score inbetwwen those numbers. For instance, if you think the vividness of the drawing is
          between 0 and 1, you can choose 0.5.
        </p>
        <img class="imageinstruction" src="./instruction/instruction3.png" alt="instruction3">
        <hr>

        <p class="numbering">4</p>
        <p class="textinstruction">Repeat the process mentioned above for 'Originality' and 'Transformation.'
          You need to open the corresponding evaluation guide for each.
          For instance, click the 'Show Original criteria' button when evaluating the originality.
          When evaluating the transformation, click the 'Show Transform criteria' button to pull the right evaluation
          guidelines pdf.
        </p>
        <hr>
        <p class="numbering">5</p>
        <p class="textinstruction">Once you give a score for each criterion, click the 'next' button at the bottom of
          the page. It will show you another image. Evaluate seven images in total, and then the study ends.


        </p>
        <hr>
        <p class="numbering">6</p>
        <p class="textinstruction"> At the end, you will see a message: 'Thank you for participating.' Then close this
          window and go back to the Qualtrics survey to receive your code. </p>
        <!-- Example video embedded from YouTube -->
        <!-- <iframe width="560" height="315" src="https://www.youtube.com/embed/YOUR_VIDEO_ID" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> -->
      </div>

    </div>




    <!-- <div id="instruction">
  
  <p class = "inst_h1"> Open the link below as a new tab. Answer questions and submit the survey. Then submit it </p>
  <a href="https://cornell.ca1.qualtrics.com/jfe/form/SV_8q87dpeZzOYdDi6">https://cornell.ca1.qualtrics.com/jfe/form/SV_8q87dpeZzOYdDi6</a>
  <p class = "inst_h1"> Evaluate images that you see.  If you click 'next' you will see a new images.</p>
</div> -->

    <div id="imageContainer">
      <!-- Image will be inserted here by JavaScript -->
    </div>
  </div>


  <div id="sliders">
    <div id="vividnessSliderDiv">
      <label class="label" for="vividnessSlider">Vividness</label>
      <div class="definitionBox">
        <span class="definition"> Degree of visualization and elaboration of mental images generated</span>
        <button id="VividnessButton">Show Vividness criteria</button>
      </div>
      <input type="range" id="vividnessSlider" name="vividness" min="1" max="5" value="3">
      <ul class="likert-markers">
        <li>0</li>
        <li>0.5</li>
        <li>1</li>
        <li>1.5</li>
        <li>2</li>
      </ul>

    </div>

    <div id="originalSliderDiv">
      <label class="label" for="originalSlider">Originality</label>
      <div class="definitionBox">
        <span class="definition">Novelty of the mental images generated</span>
        <button id="OriginalButton">Show Original criteria</button>
      </div>
      <input type="range" id="originalSlider" name="original" min="1" max="5" value="3">
      <ul class="likert-markers">
        <li>0</li>
        <li>0.5</li>
        <li>1</li>
        <li>1.5</li>
        <li>2</li>
      </ul>
    </div>

    <div id="transformSliderDiv">
      <label class="label" for="transformSlider">Transformation</label>
      <div class="definitionBox">
        <span class="definition">Ability to modify the mental images generated</span>
        <button id="TransformButton">Show Transform criteria</button>
      </div>
      <input type="range" id="transformSlider" name="transform" min="1" max="5" value="3">
      <ul class="likert-markers">
        <li>0</li>
        <li>0.5</li>
        <li>1</li>
        <li>1.5</li>
        <li>2</li>
      </ul>
    </div>

  </div>

  <div id="pdfContainer" style="position: absolute; right: 10px; top: 10px;"></div>


  <button id="nextImage">Next Image</button>

  <script src="script.js"></script>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAXNN7TE_8-HIdR75kqQ47imZhrg3Qtfks",
      authDomain: "imageeval-dd6e8.firebaseapp.com",
      databaseURL: "https://imageeval-dd6e8-default-rtdb.firebaseio.com",
      projectId: "imageeval-dd6e8",
      storageBucket: "imageeval-dd6e8.appspot.com",
      messagingSenderId: "238433835181",
      appId: "1:238433835181:web:ca3ce01a2ad81408894e24",
      measurementId: "G-5B424981D1"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);

    let imageIndex = 0;
    let imageNames = [];

    const params = new URLSearchParams(window.location.search);
    const prolificPID = params.get('PROLIFIC_PID') || 'defaultPID';

    async function fetchImageNames() {
      const response = await fetch(`/api/images?PROLIFIC_PID=${prolificPID}`);
      const data = await response.json();
      imageNames = data.map(image => image.original.split('/').pop());
    }

    fetchImageNames();


    document.addEventListener('DOMContentLoaded', function () {


      let userInput = "";

      while (userInput === null || userInput.trim() === "" || userInput === "Your ID") {
        userInput = prompt("Please enter your correct Prolific ID. We use this ID to compensate participants.", "Your ID");

        if (userInput !== null && userInput.trim() !== "" && userInput !== "Your ID") {
          // Input is not null or empty, break the loop
          document.getElementById("displayInput").innerHTML = "Hello " + userInput + "! Welcome to our study!";
          break;
        } else {
          alert("You must enter your Prolific ID to continue.");
        }
      }

      // Use userInput as needed here
      console.log("Prolific ID entered:", userInput);



      // Get the modal
      var modal = document.getElementById("myModal");

      // Get the button that opens the modal
      var btn = document.getElementById("tutorialButton");

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // When the user clicks the button, open the modal 
      btn.onclick = function () {
        modal.style.display = "block";
      }

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.style.display = "none";
      }

      // Also close the modal if the user clicks anywhere outside of it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }




      var saveUserDataButton = document.getElementById('nextImage');


      saveUserDataButton.addEventListener('click', function () {
        var vividness_value = document.getElementById('vividnessSlider').value;
        var original_value = document.getElementById('originalSlider').value;
        var transform_value = document.getElementById('transformSlider').value;

        console.log(vividness_value, original_value, transform_value);

        var userData = {
          userProlificID: userInput,
          image: imageNames[imageIndex] || 'default.png',
          scores: {
            vividness: vividness_value,
            original: original_value,
            transform: transform_value
          }
        };

        console.log(imageNames);
        console.log("image name: " + imageNames[imageIndex]);

        // var userId = push(ref(database, 'users')).key;

        // console.log(userId);

        //const userDataRef = ref(database, `users/${inputID_received}/rating/${conversationID}`);

        set(ref(database, 'users/' + userInput +'/'+ (imageIndex+1) ), userData)
          .then(() => {
            console.log("Data saved successfully.");
          })
          .catch((error) => {
            console.log("Data could not be saved." + error);
          });

        imageIndex = (imageIndex + 1) % imageNames.length;
        console.log(imageIndex);

        resetSliders();
      });
    });

  </script>


</body>

</html>